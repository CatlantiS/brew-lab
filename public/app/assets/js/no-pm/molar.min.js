"use strict";function Molar(){}var molar=new Molar;!function(){Array.prototype.filter||(Array.prototype.filter=function(t){if(void 0===this||null===this)throw new TypeError;var r=Object(this),n=r.length>>>0;if("function"!=typeof t)throw new TypeError;for(var e=[],o=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)if(i in r){var a=r[i];t.call(o,a,i,r)&&e.push(a)}return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,r){var n;if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),o=e.length>>>0;if(0===o)return-1;var i=+r||0;if(Math.abs(i)===1/0&&(i=0),i>=o)return-1;for(n=Math.max(i>=0?i:o-Math.abs(i),0);o>n;){if(n in e&&e[n]===t)return n;n++}return-1}),Array.prototype.map||(Array.prototype.map=function(t,r){var n,e,o;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),a=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=r),e=new Array(a),o=0;a>o;){var u,s;o in i&&(u=i[o],s=t.call(n,u,o,i),e[o]=s),o++}return e}),Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof t)throw new TypeError;for(var r=Object(this),n=r.length>>>0,e=arguments.length>=2?arguments[1]:void 0,o=0;n>o;o++)if(o in r&&t.call(e,r[o],o,r))return!0;return!1})}(),function(){var t=molar.array=molar.array||{};t.first=function(t,r){if(!molar.isArray(t))throw"Arg is not an array.";if(!molar.isFunction(r))throw"Callback is not a function.";var n;return t.some(function(t){return r(t)?(n=t,!0):!1}),n},t.any=function(t){if(!molar.isArray(t))throw"Arg is not an array.";var r=Object(t).length>>>0;return r>0}}(),function(){Molar.prototype.isArray=function(t){return void 0!==t&&null!==t&&t instanceof Array},Molar.prototype.isUndefined=function(t){return void 0===t||"undefined"==typeof t},Molar.prototype.isFunction=function(t){return"function"==typeof t},Molar.prototype.isInteger=function(t){return"number"==typeof t&&t%1===0},Molar.prototype.isDate=function(t){try{return-1!=t.constructor.toString().indexOf("Date")}catch(r){return!1}},Molar.prototype.through=function(){if(0===arguments.length)return void 0;if(1===arguments.length)return arguments[0];for(var t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];return t},Molar.prototype.mixin=function(t,r){for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},Molar.prototype.stringify=function(t){return JSON.stringify(t)},Molar.prototype.hash=function(t){var r,n,e,o=0;if(0===t.length)return o;for(r=0,e=t.length;e>r;r++)n=t.charCodeAt(r),o=(o<<5)-o+n,o|=0;return o}}(),function(){function t(t){this.expression=new r(t)}function r(t){this.expression=t;var r=t.split(" ");if(6!=r.length)throw"Format error";for(var e=0;e<r.length;e++){var o=l[e],i=n(r[e],o);if(null==i)throw"'"+o+"' format error";this[o]=i}}function n(t,r){try{var n,e=t.match(c),i={type:u.WILD_CARD};if(e){var a=e[1],l=e[2];return r===s.MONTH?(a=f[a]||a,l=f[l]||l):r===s.DAY_OF_WEEK&&(a=p[a]||a,l=p[l]||l),n={type:u.RANGE,minValue:+a,maxValue:+l},o(n,r)?i:n}if(e=t.match(h)){var m=t.split(",");return m=r===s.MONTH?m.map(function(t){return+(f[t]||t)}):r===s.DAY_OF_WEEK?m.map(function(t){return+(p[t]||t)}):m.map(function(t){return+t}),n={type:u.LIST,values:m},o(n,r)?i:n}if(e=t.match(y)){var v=t;return r===s.MONTH?v=f[v]||v:r===s.DAY_OF_WEEK&&(v=p[v]||v),{type:u.SINGLE,value:+v}}if("*"===t.trim())return i}catch(g){throw"Failed to parse field with error: "+g}}function e(t,r){return r=+r,t.type===u.WILD_CARD?!0:t.type===u.SINGLE?r==t.value:t.type===u.RANGE?r>=t.minValue&&r<=t.maxValue:t.type===u.LIST?!t.values.some(function(t){return t!=r}):void 0}function o(t,r){return t.type===u.WILD_CARD?!0:t.type===u.SINGLE?!1:r===s.MINUTES?i(t,0,59):r===s.HOURS?i(t,0,23):r===s.DAY_OF_MONTH?i(t,1,31):r===s.MONTH?i(t,1,12):r===s.DAY_OF_WEEK?i(t,0,6):void 0}function i(t,r,n){return t.type===u.RANGE?t.minValue==r&&t.maxValue==n:t.type===u.LIST?t.values[0]==r&&t.values[t.values.length-1]==n&&a(t.values):void 0}function a(t){if(!molar.isArray(t)||0==t.length)return!1;var r=t[0],n=t[t.length-1];if(!molar.isInteger(r)||!molar.isInteger(n)||r>=n)return!1;for(var e=r+1;n>e;e++){var o=t[e];if(!molar.isInteger(o)||e!==o)return!1}return!0}var u={RANGE:"Range",LIST:"List",SINGLE:"Single",WILD_CARD:"*"},s={MINUTES:"minutes",HOURS:"hours",DAY_OF_MONTH:"dayOfMonth",MONTH:"month",DAY_OF_WEEK:"dayOfWeek",YEAR:"year"},l=["minutes","hours","dayOfMonth","month","dayOfWeek","year"],f={JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"},p={SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"},c=/^(\w+)-(\w+)$/,h=/^(\w+,)+\w+$/,y=/^(\d{1,4}|[A-Za-z]{3})$/;t.prototype.intersects=function(t){if(!molar.isDate(t))throw"Argument is not a valid Date object";return e(this.expression.year,t.getFullYear())&&e(this.expression.month,t.getMonth()+1)&&e(this.expression.dayOfMonth,t.getDate())&&e(this.expression.dayOfWeek,t.getDay())&&e(this.expression.hours,t.getHours())?e(this.expression.minutes,t.getMinutes()):!1},t.prototype.whileIntersects=function(t,r){},Molar.prototype.Crange=t}(),function(){function t(t,r){this.allowDuplicate=t,this.ttl=r,this.collection=[]}function r(t,r,n,e){this.key=t,this.value=r,this.timestamp=n,this.expiration=e}function n(t){return t.expiration&&t.expiration<new Date}function e(t){return function(r){return t.some(function(t){return t===r.key})}}t.prototype.add=function(t,n){if(this.allowDuplicate!==!1||!this.contains(t)){var e,o=new Date;return isNaN(this.ttl)||(e=(new Date).setMinutes(o.getMinutes()+this.ttl)),this.collection.push(new r(t,n,o,e)),!0}return!1},t.prototype["import"]=function(t,r,n){n=molar.isFunction(n)?n:molar.through;for(var e=0;e<t.length;e++){var o=t[e];this.add(r(o),n(o))}return this},t.prototype.removeBy=function(t){for(var r=[],n=0,e=0;e<this.collection.length;e++)t(this.collection[e])&&r.unshift(e);for(var o=0;o<r.length;o++)this.collection.splice(r[o],1),n++;return n},t.prototype.removeFirst=function(t){for(var r,n=!1,e=0;e<this.collection.length;e++)if(t(this.collection[e])){r=e;break}return null!=r&&(this.collection.splice(r,1),n=!0),n},t.prototype.remove=function(t){var r=t;if(arguments.length>1){r=new Array(arguments.length);for(var n=0;n<r.length;n++)r[n]=arguments[n]}else molar.isArray(r)||(r=[r]);var o;if(this.allowDuplicate)o=this.removeBy(e(r));else{o=0;for(var i=this,a=0;a<r.length;a++)(function(t){i.removeFirst(function(n){return n.key===r[t]})&&o++})(a)}return o},t.prototype.removeExpired=function(){return this.removeBy(n)},t.prototype.findBy=function(t){var r=[],e=this.collection.filter(function(e){return n(e)?(r.push(e.key),!1):t(e)});return this.remove(r),e},t.prototype.findFirst=function(t){var r=[],e=molar.array.first(this.collection,function(e){return n(e)?(r.push(e.key),!1):t(e)});return this.remove(r),e},t.prototype.find=function(t){var r=t;if(arguments.length>1){r=new Array(arguments.length);for(var n=0;n<r.length;n++)r[n]=arguments[n]}else molar.isArray(r)||(r=[r]);var o;if(this.allowDuplicate)o=this.findBy(e(r));else{o=[];for(var i=this,a=0;a<r.length;a++)(function(t){o.push(i.findFirst(function(n){return n.key===r[t]}))})(a)}return o},t.prototype.contains=function(t){return null!=this.findFirst(function(r){return r.key===t})},t.prototype.values=function(){return this.collection.map(function(t){return t.value})},t.prototype.count=function(){return this.collection.length},molar["class"]=molar["class"]||{},Molar.prototype.Lookup=molar["class"].Lookup=t}(),function(){function t(){this.definitions=[]}function r(t,r){this.name=t,this.autoMap=r,this.maps=[]}t.prototype.register=function(t){return this.definitions.push(t),this},t.prototype.map=function(t,r){var n=molar.array.first(this.definitions,function(t){return t.name===r});if(null===n||molar.isUndefined(n))return null;var e={};if(molar.isArray(n.maps))for(var o=0;o<n.maps.length;o++){var i=n.maps[o];if(molar.isUndefined(i.condition)||molar.isFunction(i.condition)&&i.condition(t[i.source])){var a=molar.isFunction(i.transform)?i.transform:molar.through;e[i.target]=a(t[i.source])}}if(n.autoMap===!0)for(var u in t)t.hasOwnProperty(u)&&molar.isUndefined(e[u])&&(e[u]=t[u]);return e},r.prototype.define=function(t){return this.definition=t,this},r.prototype.addMap=function(t,r,n,e){return this.maps.push({source:t,target:r,transform:n,condition:e}),this},molar["class"]=molar["class"]||{},Molar.prototype.Mapper=Molar.prototype.ObjectMapper=molar["class"].ObjectMapper=t,Molar.prototype.MapperDef=Molar.prototype.MapperDefinition=molar["class"].MapperDefinition=r}(),function(){function t(t){molar.mixin(t,this);var n=r(t);this._orig=function(){return n}}function r(t){return molar.hash(molar.stringify(t))}t.prototype.mutated=function(){return r(this)!=this._orig()},t.prototype.rebase=function(){var t=r(this);this._orig=function(){return t}},t.compare=function(t,n){return t===n?!0:r(t)===r(n)},Molar.prototype.Mutant=t}();